jQuery(document).ready(function(a){var s,e=function(a,s){for(var e="",t=0,r=s.length;r>t;t++){var c=s[0],o=ywcwat_params.messages.error_messages[c[0]],w=ywcwat_params.messages.shop_sizes[c[1]],i=ywcwat_params.messages.log_message+" "+a+" "+o+" "+ywcwat_params.messages.on+" "+w;e+="<p>"+i+"</p>"}return e};a(document).on("click","#ywcwat_add_watermark",function(e){e.preventDefault();var t=a(this),r=a("#ywcwat_watermark_select"),c=a(".ywcwat_preview img");if(s)return void s.open();var o=[new wp.media.controller.Library({library:wp.media.query({type:"image/png"}),multiple:!1,title:t.data("choose"),priority:20,filterable:"all"})];s=wp.media.frames.downloadable_file=wp.media({title:t.data("choose"),library:{type:"image/png"},button:{text:t.data("choose")},multiple:!1,states:o}),s.on("select",function(){var e="",t="",o=s.state().get("selection");o.map(function(s){if(s=s.toJSON(),s.url){var o=s.width,w=s.height,i=1*ywcwat_params.perc_w,l=1*ywcwat_params.perc_h;if(l>0&&w>l||i>0&&o>i){a(".ywcwat_messages").removeClass("complete_task complete_all_task").addClass("error_size"),a(".ywcwat_icon").removeClass("dashicons-yes").addClass("dashicons dashicons-no");var _=ywcwat_params.messages.error_watermark_sizes;return a(".ywcwat_text").html(_),a(".ywcwat_messages").show(),!1}a(".ywcwat_messages").hide(),e=s.url,t=s.id,r.val(s.id),c.attr("src",s.url),a(".ywcwat_url").val(s.url)}})}),s.open()});var r=0;a(document).on("click",".ywcwat_apply_all_watermark",function(s){function t(s){var d={ywcwat_attach_id:s,action:ywcwat_params.actions.apply_all_watermark};a.ajax({type:"POST",url:ywcwat_params.ajax_url,data:d,dataType:"json",success:function(d){if(r==w&&"undefined"==typeof d.result)_.removeClass("complete_task").addClass("complete_all_task"),_.find(".ywcwat_icon").addClass("dashicons dashicons-yes"),_.find(".ywcwat_text").html(ywcwat_params.messages.complete_all_task),_.show(),c.prop("disabled",!1),i.hide();else{var p=e(s,d);if(a(".ywcwat_log_row td").show(),a("#ywcwat_log_container").append(p),i.progressbar("value",(r+1)/w*100),l.html(Math.round((r+1)/w*1e3)/10+"%"),n>m&&w>r)m++,r++,t(o[r]);else{c.prop("disabled",!1),i.hide(),_.addClass("complete_task"),_.find(".ywcwat_icon").addClass("dashicons dashicons-yes");var y=ywcwat_params.messages.complete_single_task+" "+r+" "+ywcwat_params.messages.more_product+" "+ywcwat_params.messages.on+" "+w;_.find(".ywcwat_text").html(y),_.show()}}}})}s.preventDefault();var c=a(this),o=JSON.parse(ywcwat_params.attach_id),w=o.length,i=a("#ywcwat-progressbar_all"),l=a("#ywcwat-progressbar-percent_all"),_=a(".ywcwat_messages");i.parents("tr").show(),_.hide(),i.progressbar(),i.show();var n=""==ywcwat_params.max_item_action?w:1*ywcwat_params.max_item_action;r==w&&(l.html("0%"),r=0);var m=0;c.prop("disabled",!0),t(o[r])}),a(document).on("click","#ywcwat_reset_watermark",function(s){var e=(a(this),window.confirm(ywcwat_params.messages.reset_confirm));if(e){var t={ywcwat_remove_watermark:"remove",action:ywcwat_params.actions.remove_watermark};a.ajax({type:"POST",url:ywcwat_params.ajax_url,data:t,dataType:"json",success:function(s){a(".ywcwat_messages").addClass("complete_task"),a(".ywcwat_icon").addClass("dashicons dashicons-yes");var e;e=0==s.success||s.success>1?s.success+" "+ywcwat_params.messages.plural_success_image+", ":s.success+" "+ywcwat_params.messages.singular_success_image+", ",e+=0==s.error||s.error>1?s.error+" "+ywcwat_params.messages.plural_error_image+", ":s.error+" "+ywcwat_params.messages.singular_error_image+", ",a(".ywcwat_text").html(e),a(".ywcwat_messages").show()}})}}),a(document).on("click","#ywcwat_show_log",function(s){s.preventDefault();var e=a(this).val(),t=a(this).data("hide_log");a(this).val(t).data("hide_log",e),a("#ywcwat_log_container").slideToggle("slow")}),a(document).on("click","#ywcwat_apply_product",function(s){s.preventDefault();var e=a(this).data("product_id"),r={product_id:e,action:ywcwat_params.actions.save_watermark_on_single_product};a.ajax({type:"POST",url:ywcwat_params.ajax_url,data:r,dataType:"json",beforeSend:function(){t.siblings(".ajax-loading").css("visibility","visible")},complete:function(){t.siblings(".ajax-loading").css("visibility","hidden")},success:function(a){}})})});